# マーケット情報

## マーケット情報概説

マーケット情報は、公開APIを通じて取得できます。現在、HTTPとWebSocketの両方のAPIを提供しています。マーケット情報の情報をタイムリーに取得するために、WebSocketを使用してアクセスすることことをお勧めします。マーケット情報のリアルタイムパフォーマンスを可能な限り高めるために、現在の公開している部分は最新のマーケットデータのみを取得することができます。もし全部の情報、または履歴情報を取得する必要がある場合は、support@fmex.comまでご連絡ください。

全てのHTTPリクエストのURLベースは: `https://api.fmex.com/`です。

全てのWebSocketリクエストのURLは: `wss://api.fmex.com/v2/ws`です。

用語は以下のように統一されます：

- `topic` サブスクリプションのテーマを示します。
- `symbol` 対応する取引通貨を示します.すべての通貨の区別に関するtopicは、topicの最後にあります。
- `ticker` マーケット情報のtickデータ、最新の買い売りの成約価格、最新の出来高、買い注文一つ売り注文一つ、24時間の出来高が含まれています。
- `depth` マーケット情報のデプス、オーダーブック、気配値を示します。
- `level` マーケット情報のデプスのタイプを示します。 例えば、 `L20`、 `L100`。
- `trade` 最新の成約と取引を示します。
- `candle` ローソクチャート、ローソク足、平均足を示します。
- `resolution` ローソクチャートの種類を示します。例えば、`M1`, `M15`。
- `base volume` 基準通貨の出来高を示します。例えば、btcusdt で btc の出来高。
- `quote volume` 評価通貨の取引量を示します。例えば、btcusdt で usdt の出来高。
- `ts` プッシュサーバーの時刻を示します。ミリ秒単位の数値フィールドです。 unix epoch in millisecond.

## WebSocket 初回接続の確立

接続に成功すると、サーバーからウェルカムメッセージが送信されます。

> サーバーからのレスポンス:

```json
{
  "type":"hello",
  "ts":1523693784042
}
```

> * `ts`: サーバーの現在時間をプッシュします。

## WebSocket 接続の維持 - heartbeat

```python
# WebSocket サーバー ping に送信し、ハートビートを維持する
import time
import fcoin

api = fcoin.authorize('key', 'secret', timestamp)
now_ms = int(time.time())
api.market.ping(now_ms)
```


WebSocketクライアント側はWebSocketサーバーとの接続を確立した後、お勧めとして、WebSocket Client  *15s*ごとに（すすめは10～20s） サーバーへpingリクエストを送ります。サーバーがクライアントのping要求を長時間受信しなかった場合、サーバーはアクティブに切断します。

### WebSocket リクエスト

 **ping コマンドを送信します**: `{"cmd":"ping","args":[$client_ts],"id":"$client_id"}`

* `client_id`: 現在のリクエストに対してクライアントが指定したカスタム id、サーバーはそのまま戻ります。
* `client_ts`: クライアントの現在時刻

> ping コマンドリクエストのデモンストレーション：

```json
{"cmd":"ping","args":[1540557696867],"id":"sample.client.id"}
```

> ping コマンドが成功したら、サーバーからのレスポンス：

```json
{
  "id":"sample.client.id",
  "type":"ping",
  "ts":1523693784042,
  "gap":112
}
```

> * `gap`: サーバーがこのステートメントを処理してからクライアントが送信するまでの時間差
> * `ts`:  サーバーの現在時刻

<aside class="notice">
tip: pingをリクエストするときにサーバーによって返されるtsおよびgap値によって、サーバー時間とデータ転送時間の差を取得できます。
</aside>

## WebSocket サブスクリプション

 **sub コマンドを送信する**: `{"cmd":"sub","args":["$topic", ...],"id":"$client_id"}`

* `client_id`: 現在のリクエストに対してクライアントが指定したカスタムIDです。サーバーはそのまま戻ります。
* `topic`: サブスクリプション待ちの topicについては、複数ある場合は英文字の「,」を使用して分けてください。最大20個までサブスクリプションできます。

> sub コマンドリクエストのデモンストレーション（単数のtopicの場合）：

```json
{"cmd":"sub","args":["ticker.ethbtc"]}
```

> sub コマンドリクエストのデモンストレーション（複数のtopicの場合）：

```json
{"cmd":"sub","args":["ticker.ethbtc", "ticker.btcusdt"]}
```

> サブスクリプションが成功したレスポンス：

```json
{
  "type": "topics",
  "topics": ["ticker.ethbtc", "ticker.btcusdt"]
}
```

> サブスクリプションが失敗したレスポンス：

```json
{
  "id":"invalid_topics_sample",
  "status":41002,
  "msg":"invalid sub topic, xxx.M1.xxx"
}
```

##  ticker データの取得

ticker情報ブロックを十分小さく、迅速に取得するために、強制的にリスト表式を使用しています。

> ticker リストの該当フィールドへの説明:

```json
[
  "最新成約価格",
  "最新の取引出来高",
  "最高の買い注文の価格",
  "最高の買い注文の出来高",
  "最安の売り注文の価格",
  "最安の売り注文の出来高",
  "24時間前の成約価格",
  "24時間内最高の価格",
  "24小时内最安の価格",
  "24時間内の基準通貨出来高、例えば、btcusdt の btc の出来高",
  "24時間内の評価通貨の出来高、例えば、btcusdt の usdt の出来高"
]
```


### HTTP リクエスト

`GET /v2/market/ticker/$symbol`


> HTTP リクエストへのレスポンス：

```json
{
  "status": 0,
  "data": {
    "type": "ticker.btcusdt",
    "seq": 680035,
    "ticker": [
      7140.890000000000000000,
      1.000000000000000000,
      7131.330000000,
      233.524600000,
      7140.890000000,
      225.495049866,
      7140.890000000,
      7140.890000000,
      7140.890000000,
      1.000000000,
      7140.890000000000000000
    ]
  }
}
```

### WebSocket サブスクリプション

 **sub コマンドを送信する**，topic: `ticker.$symbol`  ( `WebSocket サブスクリプション`を参考する)

> WebSocket 通常のサブスクリプションの通知メッセージのフォーマットは次のとおりです:

```json
{
  "type": "ticker.btcusdt",
  "seq": 680035,
  "ticker": [
    7140.890000000000000000,
    1.000000000000000000,
    7131.330000000,
    233.524600000,
    7140.890000000,
    225.495049866,
    7140.890000000,
    7140.890000000,
    7140.890000000,
    1.000000000,
    7140.890000000000000000
  ]
}
```

## 最新デプス詳細の取得

### HTTP リクエスト

`GET /v2/market/depth/$level/$symbol`

`$level` 下記種類を含みます（大文字と小文字を区別）：

タイプ | 説明
-------- | --------
`L20` | レベル20のマーケット情報
`L150` | レベル150のマーケット情報 

その中 `L20` の通知時間は `L150`より早く、通知の頻度も `L150`より多いです, 実際な圧力と状況に基づき、必要に応じて使用してください。

> HTTP リクエストのレスポンス：

```json
{
  "status":0,
  "data":{
    "type": "depth.L20.ethbtc",
    "ts": 1523619211000,
    "seq": 120,
    "bids": [0.000100000, 1.000000000, 0.000010000, 1.000000000],
    "asks": [1.000000000, 1.000000000]
  }
}
```

### WebSocket サブスクリプション

 **sub コマンドを送信する**，topic: `depth.$level.$symbol`   ( `WebSocket サブスクリプションを参照してください`)

> WebSocket サブスクリプションからのレスポンス:

```json
{
  "type": "depth.L20.ethbtc",
  "ts": 1523619211000,
  "seq": 120,
  "bids": [0.000100000, 1.000000000, 0.000010000, 1.000000000],
  "asks": [1.000000000, 1.000000000]
}
```

> bidsとasksに対応する配列は、偶数でなければならず、1つの価格を購入（売却）し、1つの数量を購入（売却）し、順次後ろに並べる必要があります。



## 最新取引詳細の取得

取引idのサイズを比較することによって、更新された取引かどうかを判断できます。{trade id} に気をつけてください。普通では、traceからtransactionまでのプロセスがあるため、公開マーケット情報での取引idは、決済システム中の取引idとは必ず一致するわけではありません。ご留意いただきたい。取引記録が1つであっても、最新の取引が再取得されたときに、IDが常に一致しているという保証はできません。

PS:  過去のマーケット情報では、取引IDが１つであることが保証できます。ここで、{transaction id}はマーケット情報の更新通知としてのみ使用され、アーカイブに使用しないでください。


### HTTP リクエスト

`GET /v2/market/trades/$symbol`

#### パラメータの照会(HTTP リクエスト)の照会

パラメータ | デフォルト値 | 説明
--------- | ------- | -----------
before |  | あるIDの前のTradeを照会します
limit |  | デフォルトは20です

### WebSocket リクエスト

 **req コマンドを送信する**: `{"cmd":"req", "args":["$topic", limit],"id":"$client_id"}`

* `client_id`: 現在のリクエストに対してクライアントが指定したカスタムIDです。サーバーはそのまま返します。
* `topic`: `trade.$symbol`
* `limit`: 取得する必要がある最近のトランザクションの数

> WebSocket リクエストが成功したレスポンスは次のとおりです：

```json
{
  "id":null,
  "ts":1523693400329,
  "data":[
    {
      "amount":1.000000000,
      "ts":1523419946174,
      "id":76000,
      "side":"sell",
      "price":4.000000000
    },
    {
      "amount":1.000000000,
      "ts":1523419114272,
      "id":74000,
      "side":"sell",
      "price":4.000000000
    },
    {
      "amount":1.000000000,
      "ts":1523415182356,
      "id":71000,
      "side":"sell",
      "price":3.000000000
    }
  ]
}
```

### WebSocket サブスクリプション

 **sub コマンドを送信する**，topic: `trade.$symbol`   ( `WebSocket サブスクリプションを参照してください`)

* `symbol`: 対応する取引ペア

> WebSocket 通常のサブスクリプションの通知メッセージのフォーマットは次のとおりです:

```json
{
  "type":"trade.ethbtc",
  "id":76000,
  "amount":1.000000000,
  "ts":1523419946174,
  "side":"sell",
  "price":4.000000000
}
```

##  Candle 情報の取得

### HTTP リクエスト

`GET /v2/market/candles/$resolution/$symbol`

#### パラメータ(HTTP リクエスト)の照会

パラメータ | デフォルト値 | 説明
--------- | ------- | -----------
before |  | あるIDの前の Candleを照会します
limit |  | デフォルトは20です

$resolution 下記種類を含みます（大文字と小文字を区別）：

タイプ    | 説明
-------- | --------
 `M1`    | 1 分
 `M3`    | 3 分
 `M5`    | 5 分
 `M15`   | 15 分
 `M30`   | 30 分
 `H1`    | 1 時間
 `H4`    | 4 時間
 `H6`    | 6 時間
 `D1`    | 1 日
 `W1`    | 1 週
 `MN`    | 1 ヶ月

### WebSocket リクエスト

**req コマンドを送信する**: `{"cmd":"req","args":["$topic",limit,before],"id":"$client_id"}`

- `client_id`: 現在のリクエストに対してクライアントが指定したカスタムIDです。サーバーはそのまま返します。
- `topic`: `candle.$resolution.$symbol`
- `limit`: 取得する必要があるcandleの数
- `before`: あるIDの前のCandleを照会する

> WebSocket リクエストが成功したレスポンスは次のとおりです：

```json
{
  "id":"candle.M15.btcusdt",
  "data":[
    {
      "id":1540809840,
      "seq":24793830600000,
      "high":6491.74,
      "low":6489.24,
      "open":6491.24,
      "close":6490.07,
      "count":26,
      "base_vol":8.2221,
      "quote_vol":53371.531286
    },
    {
      "id":1540809900,
      "seq":24793879800000,
      "high":6490.47,
      "low":6487.62,
      "open":6490.09,
      "close":6487.62,
      "count":23,
      "base_vol":10.8527,
      "quote_vol":70430.840624
    }
  ]
}
```

### WebSokcet サブスクリプション

**sub コマンドを送信する**，topic: `candle.$resbolution.$symbol`   ( `WebSocket サブスクリプションを参照してください`)

* `resolution`：  HTTP リクエストと同じの resolution パラメータ

> WebSocket サブスクリプションの通知メッセージは次のとおりです:

```json
{
  "type":"candle.M1.ethbtc",
  "id":1523691480,
  "seq":11400000,
  "open":2.000000000,
  "close":2.000000000,
  "high":2.000000000,
  "low":2.000000000,
  "count":0,
  "base_vol":0,
  "quote_vol":0
}
```


## 現在のシステムインデックスの照会

### HTTP リクエスト
`GET /v2/market/indexes`



## あるインデックスの最新の履歴値を照会する
### HTTP リクエスト
`GET /v2/market/indexes/$indexname`


## 為替レートの照会
### HTTP リクエスト
`GET /v2/market/fex`
